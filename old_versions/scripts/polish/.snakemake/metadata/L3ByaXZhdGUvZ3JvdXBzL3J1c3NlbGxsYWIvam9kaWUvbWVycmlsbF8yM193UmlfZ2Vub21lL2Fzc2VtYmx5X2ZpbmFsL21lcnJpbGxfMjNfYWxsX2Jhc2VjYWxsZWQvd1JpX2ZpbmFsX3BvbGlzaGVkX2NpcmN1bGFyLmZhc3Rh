{"code": "gASVlyMAAAAAAAAoQyCXAHQBAAAAAAAAAABkAXwNfBCsAqsDAAAAAAAAAQB5AJQojAVpbnB1dJSMBm91dHB1dJSMBnBhcmFtc5SMCXdpbGRjYXJkc5SMB3RocmVhZHOUjAlyZXNvdXJjZXOUjANsb2eUjARydWxllIwJY29uZGFfZW52lIwNY29udGFpbmVyX2ltZ5SMEHNpbmd1bGFyaXR5X2FyZ3OUjA91c2Vfc2luZ3VsYXJpdHmUjAtlbnZfbW9kdWxlc5SMDGJlbmNoX3JlY29yZJSMBWpvYmlklIwIaXNfc2hlbGyUjA9iZW5jaF9pdGVyYXRpb26UjA9jbGVhbnVwX3NjcmlwdHOUjApzaGFkb3dfZGlylIwNZWRpdF9ub3RlYm9va5SMD2NvbmRhX2Jhc2VfcGF0aJSMB2Jhc2VkaXKUjBBzb3VyY2VjYWNoZV9wYXRolIwYcnVudGltZV9zb3VyY2VjYWNoZV9wYXRolIwYX19pc19zbmFrZW1ha2VfcnVsZV9mdW5jlHSUXZQoTljyIQAACiAgICAgICAgIyBDcmVhdGUgb3V0cHV0IGFuZCB0ZW1wIGRpcmVjdG9yaWVzCiAgICAgICAgbWtkaXIgLXAge3BhcmFtcy5vdXRfZGlyfQogICAgICAgIG1rZGlyIC1wIHtwYXJhbXMudG1wX2Rpcn0KICAgICAgICAKICAgICAgICAjIEZpcnN0LCBjaGVjayBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBjaXJjdWxhciBjb250aWcgaW4gdGhlIGlucHV0IGFzc2VtYmx5CiAgICAgICAgIyBFeHRyYWN0IHNlcXVlbmNlcyB0byB0ZW1wb3JhcnkgZmlsZQogICAgICAgIHNlcXRrIHNlcSAtYSB7aW5wdXQubGlua3NfZ2FwZmlsbGVkfSA+IHtwYXJhbXMudG1wX2Rpcn0vaW5wdXQuZmEKICAgICAgICAKICAgICAgICAjIEZpbmQgdGhlIGxvbmdlc3QgY29udGlnIChsaWtlbHkgdGhlIFdvbGJhY2hpYSBnZW5vbWUpCiAgICAgICAgTE9OR0VTVF9DT05USUc9JChzZXF0ayBjb21wIHtwYXJhbXMudG1wX2Rpcn0vaW5wdXQuZmEgfCBzb3J0IC1rMiwybnIgfCBoZWFkIC1uMSB8IGN1dCAtZjEpCiAgICAgICAgCiAgICAgICAgIyBFeHRyYWN0IHRoZSBsb25nZXN0IGNvbnRpZwogICAgICAgIHNlcXRrIHN1YnNlcSB7cGFyYW1zLnRtcF9kaXJ9L2lucHV0LmZhIDwoZWNobyAiJExPTkdFU1RfQ09OVElHIikgPiB7cGFyYW1zLnRtcF9kaXJ9L2xvbmdlc3RfY29udGlnLmZhCiAgICAgICAgCiAgICAgICAgIyBHZXQgc2VxdWVuY2UgbGVuZ3RoCiAgICAgICAgTEVOR1RIPSQoc2VxdGsgY29tcCB7cGFyYW1zLnRtcF9kaXJ9L2xvbmdlc3RfY29udGlnLmZhIHwgY3V0IC1mMikKICAgICAgICAKICAgICAgICAjIENoZWNrIGZvciBjaXJjdWxhcml0eSBvZiB0aGUgbG9uZ2VzdCBjb250aWcgYnkgZXhhbWluaW5nIHRlcm1pbmFsIHJlcGVhdHMKICAgICAgICBpZiBbICRMRU5HVEggLWd0IDEwMDAwIF07IHRoZW4KICAgICAgICAgICAgIyBFeHRyYWN0IGZpcnN0IGFuZCBsYXN0IDEwMDAgYnAKICAgICAgICAgICAgaGVhZCAtbjIge3BhcmFtcy50bXBfZGlyfS9sb25nZXN0X2NvbnRpZy5mYSB8IHRhaWwgLW4xIHwgY3V0IC1jIDEtMTAwMCA+IHtwYXJhbXMudG1wX2Rpcn0vc3RhcnQuZmEKICAgICAgICAgICAgaGVhZCAtbjIge3BhcmFtcy50bXBfZGlyfS9sb25nZXN0X2NvbnRpZy5mYSB8IHRhaWwgLW4xIHwgcmV2IHwgY3V0IC1jIDEtMTAwMCB8IHJldiA+IHtwYXJhbXMudG1wX2Rpcn0vZW5kLmZhCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFVzZSBtaW5pbWFwMiBmb3IgYWxpZ25tZW50CiAgICAgICAgICAgIE1BVENIRVM9JChtaW5pbWFwMiAtYyB7cGFyYW1zLnRtcF9kaXJ9L3N0YXJ0LmZhIHtwYXJhbXMudG1wX2Rpcn0vZW5kLmZhIDI+L2Rldi9udWxsIHwgd2MgLWwpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBbICRNQVRDSEVTIC1ndCAwIF07IHRoZW4KICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIGlkZW50aXR5IHVzaW5nIG1pbmltYXAyCiAgICAgICAgICAgICAgICBJREVOVElUWT0kKG1pbmltYXAyIC1jIHtwYXJhbXMudG1wX2Rpcn0vc3RhcnQuZmEge3BhcmFtcy50bXBfZGlyfS9lbmQuZmEgMj4vZGV2L251bGwgfCBhd2sgJ3t7aWRlbnQ9JDEwLyQxMSoxMDB9fSBFTkQge3twcmludCBpZGVudH19JykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCggJChlY2hvICIkSURFTlRJVFkgPiA5NSIgfCBiYyAtbCkgKSk7IHRoZW4KICAgICAgICAgICAgICAgICAgICAjIElmIGNpcmN1bGFyLCBhdHRlbXB0IHRvIGZpeCBzdGFydCBwb3NpdGlvbiB0byBkbmFBIGdlbmUKICAgICAgICAgICAgICAgICAgICBlY2hvICJEZXRlY3RlZCBjaXJjdWxhciBjb250aWcgaW4gaW5wdXQgYXNzZW1ibHkiID4ge3BhcmFtcy50bXBfZGlyfS9jaXJjdWxhcl9zdGF0dXMudHh0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBVc2UgbWluaW1hcDIgdG8gYWxpZ24gbmFub3BvcmUgcmVhZHMgdG8gdGhlIGFzc2VtYmx5IGZvciBiZXR0ZXIgc3VwcG9ydAogICAgICAgICAgICAgICAgICAgIG1pbmltYXAyIC1heCBtYXAtb250IC10IHt0aHJlYWRzfSB7cGFyYW1zLnRtcF9kaXJ9L2xvbmdlc3RfY29udGlnLmZhIHtpbnB1dC5uYW5vcG9yZV9yZWFkc30gPiB7cGFyYW1zLnRtcF9kaXJ9L2Fsbi5zYW0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENvbnZlcnQgdG8gc29ydGVkIEJBTQogICAgICAgICAgICAgICAgICAgIHNhbXRvb2xzIHZpZXcgLWJTIHtwYXJhbXMudG1wX2Rpcn0vYWxuLnNhbSB8IHNhbXRvb2xzIHNvcnQgLW8ge3BhcmFtcy50bXBfZGlyfS9hbG4uYmFtIC0KICAgICAgICAgICAgICAgICAgICBzYW10b29scyBpbmRleCB7cGFyYW1zLnRtcF9kaXJ9L2Fsbi5iYW0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEZpbmQgZG5hQSBnZW5lIHBvc2l0aW9uIChpZiBhdmFpbGFibGUpCiAgICAgICAgICAgICAgICAgICAgcHJvZGlnYWwgLWkge3BhcmFtcy50bXBfZGlyfS9sb25nZXN0X2NvbnRpZy5mYSAtYSB7cGFyYW1zLnRtcF9kaXJ9L3Byb3RlaW5zLmZhYSAtZCB7cGFyYW1zLnRtcF9kaXJ9L2dlbmVzLmZuYSAtbyB7cGFyYW1zLnRtcF9kaXJ9L2dlbmVzLmdmZgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTG9vayBmb3IgZG5hQSBnZW5lCiAgICAgICAgICAgICAgICAgICAgaWYgZ3JlcCAtcSAiZG5hQSIge3BhcmFtcy50bXBfZGlyfS9wcm90ZWlucy5mYWE7IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IHRoZSBkbmFBIGdlbmUgY29vcmRpbmF0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgRE5BQV9DT09SRFM9JChncmVwICJkbmFBIiB7cGFyYW1zLnRtcF9kaXJ9L2dlbmVzLmdmZiB8IGhlYWQgLW4xIHwgY3V0IC1mNCw1KQogICAgICAgICAgICAgICAgICAgICAgICBTVEFSVF9QT1M9JChlY2hvICRETkFBX0NPT1JEUyB8IGN1dCAtZCcgJyAtZjEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFJlb3JpZW50IHRoZSBzZXF1ZW5jZSB0byBzdGFydCBhdCBkbmFBCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFsgISAteiAiJFNUQVJUX1BPUyIgXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBHZXQgdGhlIGZ1bGwgc2VxdWVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNFUT0kKHRhaWwgLW4rMiB7cGFyYW1zLnRtcF9kaXJ9L2xvbmdlc3RfY29udGlnLmZhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlb3JpZW50IHRvIHN0YXJ0IGF0IGRuYUEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJFT1JJRU5URURfU0VRPSIke3tTRVE6JFNUQVJUX1BPU319JHt7U0VROjA6JFNUQVJUX1BPU319IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHRoZSByZW9yaWVudGVkIHNlcXVlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICI+JExPTkdFU1RfQ09OVElHIGNpcmN1bGFyPXRydWUiID4ge3BhcmFtcy50bXBfZGlyfS9yZW9yaWVudGVkLmZhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICIkUkVPUklFTlRFRF9TRVEiID4+IHtwYXJhbXMudG1wX2Rpcn0vcmVvcmllbnRlZC5mYQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVzZSB0aGUgcmVvcmllbnRlZCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Age3BhcmFtcy50bXBfZGlyfS9yZW9yaWVudGVkLmZhIHtvdXRwdXQuZmluYWxfYXNzZW1ibHl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICJTdWNjZXNzZnVsbHkgcmVvcmllbnRlZCBjaXJjdWxhciBnZW5vbWUgdG8gc3RhcnQgYXQgZG5hQSBnZW5lIiA+PiB7cGFyYW1zLnRtcF9kaXJ9L2NpcmN1bGFyX3N0YXR1cy50eHQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiBkbmFBIG5vdCBmb3VuZCwgdXNlIHRoZSBvcmlnaW5hbCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Age3BhcmFtcy50bXBfZGlyfS9sb25nZXN0X2NvbnRpZy5mYSB7b3V0cHV0LmZpbmFsX2Fzc2VtYmx5fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAiRm91bmQgY2lyY3VsYXIgZ2Vub21lIGJ1dCBjb3VsZG4ndCBsb2NhdGUgZG5hQSBnZW5lIGZvciByZW9yaWVudGF0aW9uIiA+PiB7cGFyYW1zLnRtcF9kaXJ9L2NpcmN1bGFyX3N0YXR1cy50eHQKICAgICAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgZG5hQSBub3QgZm91bmQsIHVzZSB0aGUgb3JpZ2luYWwgc2VxdWVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgY3Age3BhcmFtcy50bXBfZGlyfS9sb25nZXN0X2NvbnRpZy5mYSB7b3V0cHV0LmZpbmFsX2Fzc2VtYmx5fQogICAgICAgICAgICAgICAgICAgICAgICBlY2hvICJGb3VuZCBjaXJjdWxhciBnZW5vbWUgYnV0IGNvdWxkbid0IGxvY2F0ZSBkbmFBIGdlbmUgZm9yIHJlb3JpZW50YXRpb24iID4+IHtwYXJhbXMudG1wX2Rpcn0vY2lyY3VsYXJfc3RhdHVzLnR4dAogICAgICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgIyBOb3QgY2lyY3VsYXIsIHVzZSBvcmlnaW5hbCBhc3NlbWJseQogICAgICAgICAgICAgICAgICAgIGNwIHtpbnB1dC5saW5rc19nYXBmaWxsZWR9IHtvdXRwdXQuZmluYWxfYXNzZW1ibHl9CiAgICAgICAgICAgICAgICAgICAgZWNobyAiQ29udGlnIGFwcGVhcnMgbm9uLWNpcmN1bGFyICg8OTUlIHRlcm1pbmFsIGlkZW50aXR5KSIgPiB7cGFyYW1zLnRtcF9kaXJ9L2NpcmN1bGFyX3N0YXR1cy50eHQKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgTm90IGNpcmN1bGFyLCB1c2Ugb3JpZ2luYWwgYXNzZW1ibHkKICAgICAgICAgICAgICAgIGNwIHtpbnB1dC5saW5rc19nYXBmaWxsZWR9IHtvdXRwdXQuZmluYWxfYXNzZW1ibHl9CiAgICAgICAgICAgICAgICBlY2hvICJObyB0ZXJtaW5hbCByZXBlYXQgZGV0ZWN0ZWQsIGxpa2VseSBub24tY2lyY3VsYXIiID4ge3BhcmFtcy50bXBfZGlyfS9jaXJjdWxhcl9zdGF0dXMudHh0CiAgICAgICAgICAgIGZpCiAgICAgICAgZWxzZQogICAgICAgICAgICAjIFRvbyBzbWFsbCwgdXNlIG9yaWdpbmFsIGFzc2VtYmx5CiAgICAgICAgICAgIGNwIHtpbnB1dC5saW5rc19nYXBmaWxsZWR9IHtvdXRwdXQuZmluYWxfYXNzZW1ibHl9CiAgICAgICAgICAgIGVjaG8gIkNvbnRpZyB0b28gc21hbGwgZm9yIHJlbGlhYmxlIGNpcmN1bGFyaXR5IGFzc2Vzc21lbnQiID4ge3BhcmFtcy50bXBfZGlyfS9jaXJjdWxhcl9zdGF0dXMudHh0CiAgICAgICAgZmkKICAgICAgICAKICAgICAgICAjIEdlbmVyYXRlIGFzc2VtYmx5IHN0YXRpc3RpY3MKICAgICAgICBlY2hvICI9PT09PSBBc3NlbWJseSBTdGF0aXN0aWNzID09PT09IiA+IHtvdXRwdXQuYXNzZW1ibHlfc3RhdHN9CiAgICAgICAgZWNobyAiRGF0ZTogJChkYXRlKSIgPj4ge291dHB1dC5hc3NlbWJseV9zdGF0c30KICAgICAgICBlY2hvICIiID4+IHtvdXRwdXQuYXNzZW1ibHlfc3RhdHN9CiAgICAgICAgCiAgICAgICAgIyBDaXJjdWxhcml0eSBzdGF0dXMKICAgICAgICBlY2hvICI9PT09PSBDaXJjdWxhcml0eSBTdGF0dXMgPT09PT0iID4+IHtvdXRwdXQuYXNzZW1ibHlfc3RhdHN9CiAgICAgICAgY2F0IHtwYXJhbXMudG1wX2Rpcn0vY2lyY3VsYXJfc3RhdHVzLnR4dCA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgIGVjaG8gIiIgPj4ge291dHB1dC5hc3NlbWJseV9zdGF0c30KICAgICAgICAKICAgICAgICAjIENvdW50IHRvdGFsIGNvbnRpZ3MKICAgICAgICBlY2hvICJUb3RhbCBjb250aWdzOiAkKGdyZXAgLWMgIl4+IiB7b3V0cHV0LmZpbmFsX2Fzc2VtYmx5fSkiID4+IHtvdXRwdXQuYXNzZW1ibHlfc3RhdHN9CiAgICAgICAgCiAgICAgICAgIyBDYWxjdWxhdGUgTjUwLCB0b3RhbCBzaXplLCBldGMuCiAgICAgICAgZWNobyAiPT09PT0gQXNzZW1ibHkgTWV0cmljcyA9PT09PSIgPj4ge291dHB1dC5hc3NlbWJseV9zdGF0c30KICAgICAgICBhc3NlbWJseS1zdGF0cyB7b3V0cHV0LmZpbmFsX2Fzc2VtYmx5fSA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgIAogICAgICAgICMgRGV0YWlsZWQgY2lyY3VsYXJpdHkgYW5hbHlzaXMgZm9yIGFsbCBjb250aWdzCiAgICAgICAgZWNobyAiIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgIGVjaG8gIj09PT09IERldGFpbGVkIENpcmN1bGFyaXR5IEFuYWx5c2lzID09PT09IiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgIAogICAgICAgICMgRXh0cmFjdCBzZXF1ZW5jZXMgdG8gdGVtcG9yYXJ5IGZpbGUKICAgICAgICBzZXF0ayBzZXEgLWEge291dHB1dC5maW5hbF9hc3NlbWJseX0gPiB7cGFyYW1zLnRtcF9kaXJ9L2ZpbmFsLmZhCiAgICAgICAgCiAgICAgICAgIyBQcm9jZXNzIGVhY2ggY29udGlnCiAgICAgICAgZm9yIFNFUSBpbiAkKGdyZXAgIl4+IiB7cGFyYW1zLnRtcF9kaXJ9L2ZpbmFsLmZhIHwgc2VkICdzLz4vLycgfCBzZWQgJ3MvIC4qLy8nKTsgZG8KICAgICAgICAgICAgZWNobyAiQ2hlY2tpbmcgY2lyY3VsYXJpdHkgb2YgY29udGlnOiAkU0VRIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBFeHRyYWN0IHRoZSBzZXF1ZW5jZQogICAgICAgICAgICBzZXF0ayBzdWJzZXEge3BhcmFtcy50bXBfZGlyfS9maW5hbC5mYSA8KGVjaG8gIiRTRVEiKSA+IHtwYXJhbXMudG1wX2Rpcn0vY29udGlnLmZhCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEdldCBzZXF1ZW5jZSBsZW5ndGgKICAgICAgICAgICAgTEVOR1RIPSQoc2VxdGsgY29tcCB7cGFyYW1zLnRtcF9kaXJ9L2NvbnRpZy5mYSB8IGN1dCAtZiAyKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgWyAkTEVOR1RIIC1ndCAyMDAwIF07IHRoZW4KICAgICAgICAgICAgICAgICMgRXh0cmFjdCBmaXJzdCBhbmQgbGFzdCAxMDAwIGJwCiAgICAgICAgICAgICAgICBoZWFkIC1uMiB7cGFyYW1zLnRtcF9kaXJ9L2NvbnRpZy5mYSB8IHRhaWwgLW4xIHwgY3V0IC1jIDEtMTAwMCA+IHtwYXJhbXMudG1wX2Rpcn0vc3RhcnQuZmEKICAgICAgICAgICAgICAgIGhlYWQgLW4yIHtwYXJhbXMudG1wX2Rpcn0vY29udGlnLmZhIHwgdGFpbCAtbjEgfCByZXYgfCBjdXQgLWMgMS0xMDAwIHwgcmV2ID4ge3BhcmFtcy50bXBfZGlyfS9lbmQuZmEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBVc2UgbWluaW1hcDIgZm9yIGFsaWdubWVudAogICAgICAgICAgICAgICAgTUFUQ0hFUz0kKG1pbmltYXAyIC1jIHtwYXJhbXMudG1wX2Rpcn0vc3RhcnQuZmEge3BhcmFtcy50bXBfZGlyfS9lbmQuZmEgMj4vZGV2L251bGwgfCB3YyAtbCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgWyAkTUFUQ0hFUyAtZ3QgMCBdOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgIyBDYWxjdWxhdGUgaWRlbnRpdHkgdXNpbmcgbWluaW1hcDIKICAgICAgICAgICAgICAgICAgICBJREVOVElUWT0kKG1pbmltYXAyIC1jIHtwYXJhbXMudG1wX2Rpcn0vc3RhcnQuZmEge3BhcmFtcy50bXBfZGlyfS9lbmQuZmEgMj4vZGV2L251bGwgfCBhd2sgJ3t7aWRlbnQ9JDEwLyQxMSoxMDB9fSBFTkQge3twcmludCBpZGVudH19JykKICAgICAgICAgICAgICAgICAgICBlY2hvICJUZXJtaW5hbCBvdmVybGFwIGlkZW50aXR5OiAkSURFTlRJVFklIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICgoICQoZWNobyAiJElERU5USVRZID4gOTUiIHwgYmMgLWwpICkpOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gIkFwcGVhcnMgdG8gYmUgY2lyY3VsYXIgKD45NSUgdGVybWluYWwgaWRlbnRpdHkpIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAiTWF5IG5vdCBiZSBjaXJjdWxhciAoPDk1JSB0ZXJtaW5hbCBpZGVudGl0eSkiID4+IHtvdXRwdXQuYXNzZW1ibHlfc3RhdHN9CiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBlY2hvICJObyB0ZXJtaW5hbCBvdmVybGFwIGRldGVjdGVkIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZWNobyAiQ29udGlnIHRvbyBzbWFsbCBmb3IgcmVsaWFibGUgY2lyY3VsYXJpdHkgY2hlY2sgKDwyMDAwIGJwKSIgPj4ge291dHB1dC5hc3NlbWJseV9zdGF0c30KICAgICAgICAgICAgZmkKICAgICAgICAgICAgZWNobyAiIiA+PiB7b3V0cHV0LmFzc2VtYmx5X3N0YXRzfQogICAgICAgIGRvbmUKICAgICAgICAKICAgICAgICAjIENsZWFudXAgdGVtcG9yYXJ5IGZpbGVzCiAgICAgICAgcm0gLXJmIHtwYXJhbXMudG1wX2Rpcn0KICAgICAgICCUaA5oEYaUZYwFc2hlbGyUhZR0lC4=", "rule": "attempt_circularization", "input": ["/private/groups/russelllab/jodie/merrill_23_wRi_genome/gapfilled/merrill_23_all_basecalled/wRi/links_gapfilled.fasta", "/private/groups/russelllab/jodie/merrill_23_wRi_genome/nanopore_data/basecalled/merrill_23_all_basecalled.wRi.fastq.gz"], "log": [], "params": ["'/private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/'", "'/private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp'"], "shellcmd": "\n        # Create output and temp directories\n        mkdir -p /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/\n        mkdir -p /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp\n        \n        # First, check if we already have a circular contig in the input assembly\n        # Extract sequences to temporary file\n        seqtk seq -a /private/groups/russelllab/jodie/merrill_23_wRi_genome/gapfilled/merrill_23_all_basecalled/wRi/links_gapfilled.fasta > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/input.fa\n        \n        # Find the longest contig (likely the Wolbachia genome)\n        LONGEST_CONTIG=$(seqtk comp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/input.fa | sort -k2,2nr | head -n1 | cut -f1)\n        \n        # Extract the longest contig\n        seqtk subseq /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/input.fa <(echo \"$LONGEST_CONTIG\") > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa\n        \n        # Get sequence length\n        LENGTH=$(seqtk comp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa | cut -f2)\n        \n        # Check for circularity of the longest contig by examining terminal repeats\n        if [ $LENGTH -gt 10000 ]; then\n            # Extract first and last 1000 bp\n            head -n2 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa | tail -n1 | cut -c 1-1000 > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa\n            head -n2 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa | tail -n1 | rev | cut -c 1-1000 | rev > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa\n            \n            # Use minimap2 for alignment\n            MATCHES=$(minimap2 -c /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa 2>/dev/null | wc -l)\n            \n            if [ $MATCHES -gt 0 ]; then\n                # Calculate identity using minimap2\n                IDENTITY=$(minimap2 -c /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa 2>/dev/null | awk '{ident=$10/$11*100} END {print ident}')\n                \n                if (( $(echo \"$IDENTITY > 95\" | bc -l) )); then\n                    # If circular, attempt to fix start position to dnaA gene\n                    echo \"Detected circular contig in input assembly\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n                    \n                    # Use minimap2 to align nanopore reads to the assembly for better support\n                    minimap2 -ax map-ont -t 10 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/nanopore_data/basecalled/merrill_23_all_basecalled.wRi.fastq.gz > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/aln.sam\n                    \n                    # Convert to sorted BAM\n                    samtools view -bS /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/aln.sam | samtools sort -o /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/aln.bam -\n                    samtools index /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/aln.bam\n                    \n                    # Find dnaA gene position (if available)\n                    prodigal -i /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa -a /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/proteins.faa -d /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/genes.fna -o /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/genes.gff\n                    \n                    # Look for dnaA gene\n                    if grep -q \"dnaA\" /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/proteins.faa; then\n                        # Extract the dnaA gene coordinates\n                        DNAA_COORDS=$(grep \"dnaA\" /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/genes.gff | head -n1 | cut -f4,5)\n                        START_POS=$(echo $DNAA_COORDS | cut -d' ' -f1)\n                        \n                        # Reorient the sequence to start at dnaA\n                        if [ ! -z \"$START_POS\" ]; then\n                            # Get the full sequence\n                            SEQ=$(tail -n+2 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa)\n                            \n                            # Reorient to start at dnaA\n                            REORIENTED_SEQ=\"${SEQ:$START_POS}${SEQ:0:$START_POS}\"\n                            \n                            # Write the reoriented sequence\n                            echo \">$LONGEST_CONTIG circular=true\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/reoriented.fa\n                            echo \"$REORIENTED_SEQ\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/reoriented.fa\n                            \n                            # Use the reoriented sequence\n                            cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/reoriented.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n                            echo \"Successfully reoriented circular genome to start at dnaA gene\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n                        else\n                            # If dnaA not found, use the original sequence\n                            cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n                            echo \"Found circular genome but couldn't locate dnaA gene for reorientation\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n                        fi\n                    else\n                        # If dnaA not found, use the original sequence\n                        cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/longest_contig.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n                        echo \"Found circular genome but couldn't locate dnaA gene for reorientation\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n                    fi\n                else\n                    # Not circular, use original assembly\n                    cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/gapfilled/merrill_23_all_basecalled/wRi/links_gapfilled.fasta /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n                    echo \"Contig appears non-circular (<95% terminal identity)\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n                fi\n            else\n                # Not circular, use original assembly\n                cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/gapfilled/merrill_23_all_basecalled/wRi/links_gapfilled.fasta /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n                echo \"No terminal repeat detected, likely non-circular\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n            fi\n        else\n            # Too small, use original assembly\n            cp /private/groups/russelllab/jodie/merrill_23_wRi_genome/gapfilled/merrill_23_all_basecalled/wRi/links_gapfilled.fasta /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta\n            echo \"Contig too small for reliable circularity assessment\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt\n        fi\n        \n        # Generate assembly statistics\n        echo \"===== Assembly Statistics =====\" > /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        echo \"Date: $(date)\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        echo \"\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        \n        # Circularity status\n        echo \"===== Circularity Status =====\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        cat /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/circular_status.txt >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        echo \"\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        \n        # Count total contigs\n        echo \"Total contigs: $(grep -c \"^>\" /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta)\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        \n        # Calculate N50, total size, etc.\n        echo \"===== Assembly Metrics =====\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        assembly-stats /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        \n        # Detailed circularity analysis for all contigs\n        echo \"\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        echo \"===== Detailed Circularity Analysis =====\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        \n        # Extract sequences to temporary file\n        seqtk seq -a /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/wRi_final_polished_circular.fasta > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/final.fa\n        \n        # Process each contig\n        for SEQ in $(grep \"^>\" /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/final.fa | sed 's/>//' | sed 's/ .*//'); do\n            echo \"Checking circularity of contig: $SEQ\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n            \n            # Extract the sequence\n            seqtk subseq /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/final.fa <(echo \"$SEQ\") > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/contig.fa\n            \n            # Get sequence length\n            LENGTH=$(seqtk comp /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/contig.fa | cut -f 2)\n            \n            if [ $LENGTH -gt 2000 ]; then\n                # Extract first and last 1000 bp\n                head -n2 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/contig.fa | tail -n1 | cut -c 1-1000 > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa\n                head -n2 /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/contig.fa | tail -n1 | rev | cut -c 1-1000 | rev > /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa\n                \n                # Use minimap2 for alignment\n                MATCHES=$(minimap2 -c /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa 2>/dev/null | wc -l)\n                \n                if [ $MATCHES -gt 0 ]; then\n                    # Calculate identity using minimap2\n                    IDENTITY=$(minimap2 -c /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/start.fa /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp/end.fa 2>/dev/null | awk '{ident=$10/$11*100} END {print ident}')\n                    echo \"Terminal overlap identity: $IDENTITY%\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n                    \n                    if (( $(echo \"$IDENTITY > 95\" | bc -l) )); then\n                        echo \"Appears to be circular (>95% terminal identity)\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n                    else\n                        echo \"May not be circular (<95% terminal identity)\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n                    fi\n                else\n                    echo \"No terminal overlap detected\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n                fi\n            else\n                echo \"Contig too small for reliable circularity check (<2000 bp)\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n            fi\n            echo \"\" >> /private/groups/russelllab/jodie/merrill_23_wRi_genome/assembly_final/merrill_23_all_basecalled/assembly_stats.txt\n        done\n        \n        # Cleanup temporary files\n        rm -rf /private/groups/russelllab/jodie/merrill_23_wRi_genome/tmp/merrill_23_all_basecalled_assembly_tmp\n        ", "incomplete": false, "starttime": 1741639074.45466, "endtime": 1741639100.2575045, "job_hash": 8757669619734, "conda_env": null, "container_img_url": null, "input_checksums": {}}